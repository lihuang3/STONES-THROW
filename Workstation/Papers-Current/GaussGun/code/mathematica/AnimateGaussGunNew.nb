(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 8.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     93522,       2073]
NotebookOptionsPosition[     92803,       2045]
NotebookOutlinePosition[     93238,       2062]
CellTagsIndexPosition[     93195,       2059]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Animate a Gauss Gun", "Section",
 CellChangeTimes->{{3.617449996884294*^9, 3.617450011454197*^9}, {
   3.617450046412547*^9, 3.617450052059867*^9}, 3.617821443475154*^9, {
   3.618692062360569*^9, 3.618692064086041*^9}}],

Cell["\<\
TODO:
Add a manipulation slider with 5 stages for each moving ball (Nmag+1), and an \
animation step for each intermediate collision (a+1)*Nmag

Assume that the steel ball - bearings have negligible effect on magnetic \
field (not true)
Assume no rolling resistance
No ohmic heating, Elastic collisions.\
\>", "Text",
 CellChangeTimes->{{3.617453452343585*^9, 3.617453498149025*^9}, 
   3.6178139247400007`*^9, {3.617813970604473*^9, 3.6178140699505167`*^9}, {
   3.617814148188266*^9, 3.617814153269339*^9}, 3.617821443480798*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Drawing", " ", "routines"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"DrawMagnet", "[", 
     RowBox[{"x_", ",", "r_"}], "]"}], ":=", " ", 
    RowBox[{"{", 
     RowBox[{"Red", ",", 
      RowBox[{"Disk", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", "0"}], "}"}], ",", "r"}], "]"}], " ", ",", "Green",
       ",", " ", 
      RowBox[{"Disk", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", "0"}], "}"}], ",", "r", ",", 
        RowBox[{"{", 
         RowBox[{
          FractionBox[
           RowBox[{"-", "\[Pi]"}], "2"], ",", 
          FractionBox["\[Pi]", "2"]}], "}"}]}], "]"}]}], "  ", "}"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DrawBall", "[", 
      RowBox[{"x_", ",", "r_"}], "]"}], ":=", " ", 
     RowBox[{"{", 
      RowBox[{"Gray", ",", 
       RowBox[{"Disk", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"x", ",", "0"}], "}"}], ",", "r"}], "]"}]}], "  ", "}"}]}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DrawCollision", "[", 
      RowBox[{"x_", ",", "r_"}], "]"}], ":=", 
     RowBox[{"{", 
      RowBox[{"Yellow", ",", 
       RowBox[{"Module", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"kmax", " ", "=", " ", "16"}], "}"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Polygon", "[", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"\[Theta]", " ", "=", 
              RowBox[{
               RowBox[{"2", 
                FractionBox[
                 RowBox[{"\[Pi]", " ", "k"}], "kmax"]}], "+", 
               RowBox[{"RandomReal", "[", 
                FractionBox[
                 RowBox[{"2", "\[Pi]", " "}], "kmax"], "]"}]}]}], ";", " ", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"x", ",", "0"}], "}"}], "+", 
              RowBox[{"r", ".8", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Sin", "[", "\[Theta]", "]"}], ",", 
                 RowBox[{"2", 
                  RowBox[{"Cos", "[", "\[Theta]", "]"}]}]}], "}"}], 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"EvenQ", "[", "k", "]"}], ",", "1", ",", 
                 RowBox[{"1", "/", "3"}]}], "]"}]}]}]}], ",", 
            RowBox[{"{", 
             RowBox[{"k", ",", "1", ",", "kmax"}], "}"}]}], "]"}], "]"}]}], 
        "\[IndentingNewLine]", "]"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Math", " ", "functions"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"massCapsule", "[", "rad_", "]"}], ":=", 
     RowBox[{
      FractionBox["4", "3"], "\[Pi]", " ", 
      SuperscriptBox["rad", "3"], "7850"}]}], ";"}], " ", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Density", " ", "steel"}], " ", "=", " ", 
     RowBox[{"7850", " ", 
      RowBox[{"kg", "/", 
       SuperscriptBox["m", "3"]}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"PosBefore", "[", 
      RowBox[{"r_", ",", "a_", ",", "Nmag_", ",", "n_"}], "]"}], ":=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "a"}], " ", "-", "2", "+", " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"2", "+", 
             RowBox[{"2", " ", "n"}], "+", "a"}], ")"}], "k"}]}], ")"}], 
        "r"}], ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", "0", ",", "Nmag"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MagPos", "[", 
      RowBox[{"r_", ",", "a_", ",", "Nmag_", ",", "n_"}], "]"}], ":=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", " ", 
         RowBox[{"2", "+", 
          RowBox[{"2", "n"}], "+", "a"}], ")"}], "r", " ", "k"}], " ", ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", "0", ",", 
         RowBox[{"Nmag", "-", "1"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"PosAfterANIMATE", "[", 
      RowBox[{
      "r_", ",", "a_", ",", "Nmag_", ",", "n_", ",", "aStep_", ",", 
       "interSteps_"}], "]"}], ":=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "a"}], " ", "-", "2", "+", " ", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"2", "+", 
             RowBox[{"2", " ", "n"}], "+", "a"}], ")"}], "k"}], "+", 
          RowBox[{"a", " ", 
           RowBox[{"Max", "[", 
            RowBox[{"0", ",", " ", 
             RowBox[{"Min", "[", 
              RowBox[{
               RowBox[{"(", 
                FractionBox[
                 RowBox[{"aStep", "-", 
                  RowBox[{"k", 
                   RowBox[{"(", " ", 
                    RowBox[{"interSteps", "+", "n"}], ")"}]}]}], 
                 "interSteps"], ")"}], ",", "1"}], "]"}]}], "]"}]}]}], ")"}], 
        "r"}], ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", "0", ",", "Nmag"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"PEenergy", "[", 
      RowBox[{"r_", ",", "d_"}], "]"}], ":=", " ", 
     FractionBox[
      RowBox[{
       FractionBox[
        RowBox[{"6.490602773423956`*^6", " "}], "2"], 
       SuperscriptBox["r", "6"]}], 
      SuperscriptBox["d", "3"]]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"PEBefore", "[", 
      RowBox[{"r_", ",", "a_", ",", "Nmag_", ",", "n_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Pb", " ", "=", " ", 
         RowBox[{"PosBefore", "[", 
          RowBox[{"r", ",", "a", ",", "Nmag", ",", "n"}], "]"}]}], "}"}], ",",
        "\[IndentingNewLine]", 
       RowBox[{"Total", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"PEenergy", "[", 
            RowBox[{"r", ",", 
             RowBox[{"Abs", "[", "   ", 
              RowBox[{
               RowBox[{
               "Pb", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}], 
               " ", "-", "  ", 
               RowBox[{"MagPos", "[", 
                RowBox[{"r", ",", "a", ",", "Nmag", ",", "n"}], "]"}]}], 
              "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", 
             RowBox[{"Length", "[", "Pb", "]"}]}], "}"}]}], "]"}], ",", "2"}],
         "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"PEAfterANIMATE", "[", 
      RowBox[{
      "r_", ",", "a_", ",", "Nmag_", ",", "n_", ",", "aStep_", ",", 
       "interSteps_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"PA", " ", "=", 
         RowBox[{"PosAfterANIMATE", "[", 
          RowBox[{
          "r", ",", "a", ",", "Nmag", ",", "n", ",", "aStep", ",", 
           "interSteps"}], "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Total", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"PEenergy", "[", 
            RowBox[{"r", ",", 
             RowBox[{"Abs", "[", "   ", 
              RowBox[{
               RowBox[{
               "PA", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}], 
               " ", "-", "  ", 
               RowBox[{"MagPos", "[", 
                RowBox[{"r", ",", "a", ",", "Nmag", ",", "n"}], "]"}]}], 
              "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", 
             RowBox[{"Length", "[", "PA", "]"}]}], "}"}]}], "]"}], ",", "2"}],
         "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"PEtoVelocity", "[", 
      RowBox[{"\[CapitalDelta]PE_", ",", "m_"}], "]"}], ":=", 
     RowBox[{"Max", "[", 
      RowBox[{"0", ",", 
       RowBox[{"Re", "[", 
        SqrtBox[
         FractionBox[
          RowBox[{"2", "\[CapitalDelta]PE"}], "m"]], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ballPos", "[", 
      RowBox[{
      "r_", ",", "a_", ",", "Nmag_", ",", "n_", ",", "aStep_", ",", 
       "interSteps_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"ofset", ",", "stage", ",", "collpos"}], "}"}], ",", 
       "\[IndentingNewLine]", " ", 
       RowBox[{"If", "[", " ", 
        RowBox[{
         RowBox[{
          RowBox[{"ofset", " ", "=", 
           RowBox[{
            RowBox[{"Mod", "[", " ", 
             RowBox[{
              RowBox[{"aStep", "-", "1"}], ",", 
              RowBox[{"(", 
               RowBox[{"interSteps", "+", "n"}], ")"}]}], "]"}], "-", 
            "interSteps", "+", "1"}]}], " ", ";", "\[IndentingNewLine]", 
          RowBox[{"stage", "=", 
           RowBox[{"Max", "[", 
            RowBox[{"0", ",", 
             RowBox[{"Floor", "[", 
              FractionBox[
               RowBox[{"aStep", "-", "1"}], 
               RowBox[{"(", 
                RowBox[{"interSteps", "+", "n"}], ")"}]], "]"}]}], "]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"collpos", " ", "=", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"2", "ofset"}], "-", "1", " ", "+", 
              RowBox[{"2", 
               RowBox[{"(", " ", 
                RowBox[{
                 FractionBox["a", "2"], "+", "n", "+", "1"}], ")"}], " ", 
               "stage"}]}], ")"}], "r"}]}], ";", "\[IndentingNewLine]", " ", 
          RowBox[{
           RowBox[{"ofset", " ", "\[GreaterEqual]", " ", "0"}], " ", "&&", 
           RowBox[{"aStep", ">", "1"}], "&&", " ", 
           RowBox[{"aStep", "\[LessEqual]", 
            RowBox[{"Nmag", 
             RowBox[{"(", 
              RowBox[{"interSteps", "+", "n"}], ")"}]}]}]}]}], ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"collision", "!"}], "*)"}], 
         RowBox[{"collpos", "-", "r"}], ",", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"no", " ", "collision"}], "*)"}], "\[IndentingNewLine]", 
         " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"-", "a"}], " ", "-", "2", "+", " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"2", "+", 
               RowBox[{"2", " ", "n"}], "+", "a"}], ")"}], "stage"}], "+", 
            RowBox[{"a", " ", 
             RowBox[{"Max", "[", 
              RowBox[{"0", ",", " ", 
               RowBox[{"Min", "[", 
                RowBox[{
                 RowBox[{"(", 
                  FractionBox[
                   RowBox[{"aStep", "-", 
                    RowBox[{"stage", 
                    RowBox[{"(", " ", 
                    RowBox[{"interSteps", "+", "n"}], ")"}]}]}], 
                   "interSteps"], ")"}], ",", "1"}], "]"}]}], "]"}]}]}], 
           ")"}], "r"}]}], "\[IndentingNewLine]", "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"veloc", "[", 
      RowBox[{
      "r_", ",", "a_", ",", "Nmag_", ",", "n_", ",", "aStep_", ",", 
       "interSteps_"}], "]"}], ":=", " ", 
     RowBox[{"PEtoVelocity", "[", 
      RowBox[{
       RowBox[{"Chop", "[", 
        RowBox[{
         RowBox[{"PEAfterANIMATE", "[", 
          RowBox[{
          "r", ",", "a", ",", "Nmag", ",", "n", ",", "aStep", ",", 
           "interSteps"}], "]"}], "-", 
         RowBox[{"PEBefore", "[", 
          RowBox[{"r", ",", "a", ",", "Nmag", ",", "n"}], "]"}]}], "]"}], ",", 
       RowBox[{"massCapsule", "[", "r", "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.618694042306147*^9, 3.6186940509194317`*^9}, {
   3.6186942868979063`*^9, 3.61869428875274*^9}, {3.6186948812459307`*^9, 
   3.6186949228633213`*^9}, {3.618697254321574*^9, 3.618697280501684*^9}, {
   3.618697690508213*^9, 3.618697692681499*^9}, 3.619370966492703*^9, 
   3.6193711595685663`*^9, {3.619371332537771*^9, 3.6193713443797398`*^9}, {
   3.6193721698751783`*^9, 3.619372209678903*^9}, {3.619372306125925*^9, 
   3.6193723187652187`*^9}, {3.619372486298401*^9, 3.6193724876577187`*^9}, {
   3.6193727142071*^9, 3.619372762439344*^9}, {3.619372833270248*^9, 
   3.61937292563766*^9}, {3.619372956938739*^9, 3.619373002827322*^9}, {
   3.619385085706294*^9, 3.619385096489555*^9}, {3.619385281225459*^9, 
   3.61938528686555*^9}, {3.619386262905758*^9, 3.619386276592808*^9}, {
   3.6193863217535458`*^9, 3.6193863224202003`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Manipulate", "[", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "ofset", ",", "magposes", ",", "ballposes", ",", "collpos", ",", 
       "stage", ",", "velocity", ",", "textPos", ",", 
       RowBox[{"interStepsFine", "=", "20"}], ",", "maxVel", ",", 
       RowBox[{"wid", " ", "=", " ", "500"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"interSteps", "=", "4"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{"a", "<", 
         RowBox[{"2", 
          RowBox[{"(", 
           RowBox[{"n", "-", "1"}], ")"}]}]}], ",", 
        RowBox[{"a", "=", 
         RowBox[{"2", 
          RowBox[{"(", 
           RowBox[{"n", "-", "1"}], ")"}]}]}]}], "]"}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"if", " ", "a"}], "<", 
         RowBox[{"2", 
          RowBox[{"(", 
           RowBox[{"n", "-", "1"}], ")"}]}]}], ",", " ", 
        RowBox[{
        "the", " ", "starting", " ", "configuration", " ", "is", " ", "not", 
         " ", "stable"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"aStep", ">", 
         RowBox[{"interSteps", "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"interSteps", "+", "n"}], ")"}], "Nmag"}]}]}], ",", 
        RowBox[{"aStep", "=", 
         RowBox[{"interSteps", "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"interSteps", "+", "n"}], ")"}], "Nmag"}]}]}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Column", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Graphics", "[", 
          RowBox[{
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{"(*", "background", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"White", ",", " ", 
             RowBox[{"Rectangle", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"(", 
                    RowBox[{"8", "+", "a"}], ")"}]}], "r"}], ",", "0"}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", "Nmag", ")"}], " ", "2", 
                   RowBox[{"(", 
                    RowBox[{
                    FractionBox["a", "2"], "+", "1", "+", "n"}], ")"}], "r"}],
                   "-", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"1", "+", "a"}], ")"}], " ", "r"}], "+", "0.1"}], 
                 ",", 
                 RowBox[{"2", "r"}]}], "}"}]}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", "Floor", "*)"}], "\[IndentingNewLine]", 
             RowBox[{"EdgeForm", "[", "Black", "]"}], ",", 
             "\[IndentingNewLine]", "Brown", ",", " ", 
             RowBox[{"Rectangle", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"(", 
                    RowBox[{"4", "+", "a"}], ")"}]}], "r"}], ",", 
                 RowBox[{
                  RowBox[{"-", "8"}], "r"}]}], "}"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", "Nmag", ")"}], "2", 
                   RowBox[{"(", 
                    RowBox[{
                    FractionBox["a", "2"], "+", "1", "+", "n"}], ")"}], "r"}],
                   "-", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"1", "+", "a"}], ")"}], "r"}]}], ",", 
                 RowBox[{"-", "r"}]}], "}"}]}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"magposes", " ", "=", 
               RowBox[{"MagPos", "[", 
                RowBox[{"r", ",", "a", ",", "Nmag", ",", "n"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
               "draw", " ", "all", " ", "magnets", " ", "and", " ", 
                "stationary", " ", "balls"}], "*)"}], "\[IndentingNewLine]", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"DrawMagnet", "[", 
                   RowBox[{
                    RowBox[{
                    "magposes", "\[LeftDoubleBracket]", "j", 
                    "\[RightDoubleBracket]"}], ",", "r"}], "]"}], ",", " ", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"DrawBall", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "magposes", "\[LeftDoubleBracket]", "j", 
                    "\[RightDoubleBracket]"}], "+", 
                    RowBox[{"balls", " ", "2", "r"}]}], ",", "r"}], "]"}], 
                    ",", 
                    RowBox[{"{", 
                    RowBox[{"balls", ",", "1", ",", 
                    RowBox[{"n", "-", "1"}]}], "}"}]}], "]"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"j", ",", "1", ",", 
                  RowBox[{"Length", "[", "magposes", "]"}]}], "}"}]}], 
               "]"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"velocity", " ", "=", " ", 
               RowBox[{"veloc", "[", 
                RowBox[{
                "r", ",", "a", ",", "Nmag", ",", "n", ",", "aStep", ",", 
                 "interSteps"}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{"Draw", " ", "Moveable", " ", "balls"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"ballposes", " ", "=", " ", 
               RowBox[{"PosAfterANIMATE", "[", 
                RowBox[{
                "r", ",", "a", ",", "Nmag", ",", "n", ",", "aStep", ",", 
                 "interSteps"}], "]"}]}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"Table", "[", " ", 
               RowBox[{
                RowBox[{"DrawBall", "[", 
                 RowBox[{
                  RowBox[{
                  "ballposes", "\[LeftDoubleBracket]", "j", 
                   "\[RightDoubleBracket]"}], ",", "r"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"j", ",", "1", ",", 
                  RowBox[{"Length", "[", "ballposes", "]"}]}], "}"}]}], 
               "]"}]}], " ", ",", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"Draw", " ", 
               RowBox[{"Collisions", "?"}]}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{"If", "[", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"ofset", " ", "=", 
                 RowBox[{
                  RowBox[{"Mod", "[", " ", 
                   RowBox[{
                    RowBox[{"aStep", "-", "1"}], ",", 
                    RowBox[{"(", 
                    RowBox[{"interSteps", "+", "n"}], ")"}]}], "]"}], "-", 
                  "interSteps", "+", "1"}]}], " ", ";", "\[IndentingNewLine]", 
                RowBox[{"stage", "=", 
                 RowBox[{"Max", "[", 
                  RowBox[{"0", ",", 
                   RowBox[{"Floor", "[", 
                    FractionBox[
                    RowBox[{"aStep", "-", "1"}], 
                    RowBox[{"(", 
                    RowBox[{"interSteps", "+", "n"}], ")"}]], "]"}]}], 
                  "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"collpos", " ", "=", " ", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"2", "ofset"}], "-", "1", " ", "+", 
                    RowBox[{"2", 
                    RowBox[{"(", " ", 
                    RowBox[{
                    FractionBox["a", "2"], "+", "n", "+", "1"}], ")"}], " ", 
                    "stage"}]}], ")"}], "r"}]}], ";", "\[IndentingNewLine]", 
                " ", 
                RowBox[{
                 RowBox[{"ofset", " ", "\[GreaterEqual]", " ", "0"}], " ", "&&", 
                 RowBox[{"aStep", ">", "1"}], "&&", " ", 
                 RowBox[{"aStep", "\[LessEqual]", 
                  RowBox[{"Nmag", 
                   RowBox[{"(", 
                    RowBox[{"interSteps", "+", "n"}], ")"}]}]}]}]}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"{", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"DrawCollision", "[", 
                  RowBox[{"collpos", ",", "r"}], "]"}], "\[IndentingNewLine]",
                  ",", 
                 RowBox[{"(*", 
                  RowBox[{
                  "annotate", " ", "velocity", " ", "if", " ", "collision"}], 
                  "*)"}], "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"textPos", "=", 
                   RowBox[{"collpos", "+", "r"}]}], ";"}]}], "}"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"(*", 
                 RowBox[{
                 "annotate", " ", "velocity", " ", "if", " ", "no", " ", 
                  "collision"}], "*)"}], "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"textPos", "=", " ", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "a"}], " ", "-", "2", "+", " ", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"2", "+", 
                    RowBox[{"2", " ", "n"}], "+", "a"}], ")"}], "stage"}], 
                    "+", 
                    RowBox[{"a", " ", 
                    RowBox[{"Max", "[", 
                    RowBox[{"0", ",", " ", 
                    RowBox[{"Min", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    FractionBox[
                    RowBox[{"aStep", "-", 
                    RowBox[{"stage", 
                    RowBox[{"(", " ", 
                    RowBox[{"interSteps", "+", "n"}], ")"}]}]}], 
                    "interSteps"], ")"}], ",", "1"}], "]"}]}], "]"}]}]}], 
                    ")"}], "r"}]}], ";"}], "\[IndentingNewLine]", "}"}]}], 
              "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"Black", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                 RowBox[{"Style", "[", " ", 
                  RowBox[{
                   RowBox[{"StringForm", "[", 
                    RowBox[{"\"\<``m/s\>\"", ",", 
                    RowBox[{"NumberForm", "[", 
                    RowBox[{
                    RowBox[{"Chop", "[", "velocity", "]"}], ",", "3"}], 
                    "]"}]}], "]"}], ",", "20"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"textPos", ",", "r"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"Center", ",", "Bottom"}], "}"}]}], "]"}]}], "}"}], 
             ",", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{"draw", " ", 
                RowBox[{"trajectory", "!"}], "   ", "Fgrav"}], " ", "=", " ", 
               
               RowBox[{
                RowBox[{"-", "9.81"}], "*", "mass"}]}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
              "draw", " ", "scale", " ", "bar", " ", "and", " ", "ticks"}], 
              "*)"}], "\[IndentingNewLine]", ",", 
             RowBox[{"Darker", "[", "Gray", "]"}], ",", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Line", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"x", "/", "10"}], ",", 
                    RowBox[{
                    RowBox[{"-", "8"}], "r"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"x", "/", "10"}], ",", 
                    RowBox[{"-", "r"}]}], "}"}]}], "}"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"x", ",", "0", ",", 
                 RowBox[{"Floor", "[", 
                  RowBox[{
                   RowBox[{"10", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", "Nmag", ")"}], "2", 
                    RowBox[{"(", 
                    RowBox[{
                    FractionBox["a", "2"], "+", "1", "+", "n"}], ")"}], "r"}],
                     "-", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", "a"}], ")"}], "r"}]}], ")"}]}], "+", 
                   "1"}], "]"}]}], "}"}]}], "]"}], "\[IndentingNewLine]", ",", 
             RowBox[{"Arrowheads", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", ".03"}], ",", ".03"}], "}"}], "]"}], ",", 
             RowBox[{"Arrow", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{
                   RowBox[{"-", "4"}], "r"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"1", "/", "10"}], ",", 
                  RowBox[{
                   RowBox[{"-", "4"}], "r"}]}], "}"}]}], "}"}], "]"}], ",", 
             RowBox[{"Text", "[", 
              RowBox[{
               RowBox[{"Style", "[", 
                RowBox[{"\"\<100mm\>\"", ",", "20"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"1", "/", "20"}], ",", 
                 RowBox[{
                  RowBox[{"-", "5"}], "r"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"Center", ",", "Top"}], "}"}]}], "]"}], ","}], 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{
               RowBox[{"maxVel", " ", "=", " ", 
                RowBox[{"veloc", "[", 
                 RowBox[{"n", ",", "a", ",", "r", ",", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"1", "+", "n"}], " ", ")"}], "Nmag"}], ",", 
                  "Nmag", ",", "1"}], "]"}]}], ";", " ", "Blue"}], ",", 
              "Thick", ",", 
              RowBox[{"Line", "[", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"ballPos", "[", 
                    RowBox[{
                    "n", ",", "a", ",", "r", ",", "aStep2", ",", "Nmag", ",", 
                    "interStepsFine"}], "]"}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"-", "20"}], "r"}], "+", " ", 
                    RowBox[{"4", 
                    RowBox[{"r", "/", "maxVel"}], " ", 
                    RowBox[{"veloc", "[", 
                    RowBox[{
                    "n", ",", "a", ",", "r", ",", "aStep2", ",", "Nmag", ",", 
                    "interStepsFine"}], "]"}]}]}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"aStep2", ",", "0", ",", 
                   RowBox[{"interStepsFine", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"interStepsFine", "+", "n"}], ")"}], "Nmag"}]}]}],
                   "}"}]}], "]"}], "]"}]}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"Inset", "[", 
              RowBox[{
               RowBox[{"ListPlot", "[", 
                RowBox[{
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"ballPos", "[", 
                    RowBox[{
                    "n", ",", "a", ",", "r", ",", "aStep2", ",", "Nmag", ",", 
                    "interStepsFine"}], "]"}], ",", 
                    RowBox[{"veloc", "[", 
                    RowBox[{
                    "n", ",", "a", ",", "r", ",", "aStep2", ",", "Nmag", ",", 
                    "interStepsFine"}], "]"}]}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"aStep2", ",", "0", ",", 
                    RowBox[{"interStepsFine", "+", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"interStepsFine", "+", "n"}], ")"}], "Nmag"}]}]}],
                     "}"}]}], "]"}], ",", 
                 RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                 RowBox[{"PlotStyle", "\[Rule]", "Thick"}], ",", 
                 RowBox[{"AxesOrigin", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", "a"}], " ", "r"}], "-", 
                    RowBox[{"2", "r"}]}], ",", "0"}], "}"}]}], ",", 
                 RowBox[{"Frame", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{"True", ",", "True", ",", "False", ",", "False"}], 
                   "}"}]}], ",", 
                 RowBox[{"FrameLabel", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{
                   "\"\<Moving Ball position\>\"", ",", "\"\<Velocity\>\""}], 
                   "}"}]}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", "a"}], " ", "r"}], "-", 
                  RowBox[{"2", "r"}]}], ",", 
                 RowBox[{
                  RowBox[{"-", "25"}], "r"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", "a"}], " ", "r"}], "-", 
                  RowBox[{"2", "r"}]}], ",", "0"}], "}"}], ",", 
               RowBox[{"1", "/", "5"}]}], "]"}], "*)"}], 
            "\[IndentingNewLine]", "}"}], ",", 
           RowBox[{"ImageSize", "\[Rule]", " ", 
            RowBox[{"{", 
             RowBox[{"wid", ",", "200"}], "}"}]}]}], "\[IndentingNewLine]", 
          "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"1000", 
                  RowBox[{"ballPos", "[", 
                   RowBox[{
                   "r", ",", "a", ",", "Nmag", ",", "n", ",", "aStep2", ",", 
                    "interStepsFine"}], "]"}]}], ",", 
                 RowBox[{"veloc", "[", 
                  RowBox[{
                  "r", ",", "a", ",", "Nmag", ",", "n", ",", "aStep2", ",", 
                   "interStepsFine"}], "]"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"aStep2", ",", "0", ",", 
                 RowBox[{"interStepsFine", "+", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"interStepsFine", "+", "n"}], ")"}], "Nmag"}]}]}],
                 "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"1000", 
                  RowBox[{"ballPos", "[", 
                   RowBox[{
                   "r", ",", "a", ",", "Nmag", ",", "n", ",", "aStep2", ",", 
                    "1"}], "]"}]}], ",", 
                 RowBox[{"veloc", "[", 
                  RowBox[{
                  "r", ",", "a", ",", "Nmag", ",", "n", ",", "aStep2", ",", 
                   "1"}], "]"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"aStep2", ",", "1", ",", 
                 RowBox[{"1", "+", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"1", "+", "n"}], ")"}], "Nmag"}], "-", "1"}]}], 
                "}"}]}], "]"}]}], "\[IndentingNewLine]", "}"}], ",", 
           RowBox[{"Joined", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"True", ",", "False"}], "}"}]}], ",", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Automatic", ",", 
                RowBox[{"1000", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", "Nmag", ")"}], " ", "2", 
                    RowBox[{"(", 
                    RowBox[{
                    FractionBox["a", "2"], "+", "1", "+", "n"}], ")"}], "r"}],
                    "-", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "+", "a"}], ")"}], " ", "r"}], "+", "0.1"}], 
                  ")"}]}]}], "}"}], ",", "Automatic"}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"MeshStyle", "\[Rule]", 
            RowBox[{"PointSize", "[", "Large", "]"}]}], 
           RowBox[{"(*", 
            RowBox[{",", 
             RowBox[{"PlotMarkers", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"\"\<\>\"", ",", 
                RowBox[{"{", 
                 RowBox[{
                  StyleBox["\[FivePointedStar]",
                   FontColor->RGBColor[1, 0, 1]], ",", "20"}], "}"}]}], 
               "}"}]}]}], "*)"}], ",", 
           RowBox[{"PlotStyle", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"Thick", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"PointSize", "[", "Large", "]"}], ",", "Blue"}], 
               "}"}]}], "}"}]}], ",", 
           RowBox[{"AxesOrigin", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"1000", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", "a"}], " ", "r"}], "-", 
                 RowBox[{"2", "r"}]}], ")"}]}], ",", "0"}], "}"}]}], ",", 
           RowBox[{"Frame", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"True", ",", "True", ",", "False", ",", "False"}], 
             "}"}]}], ",", 
           RowBox[{"FrameLabel", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
             "\"\<Moving Ball position (mm)\>\"", ",", 
              "\"\<Velocity (m/s)\>\""}], "}"}]}], ",", 
           RowBox[{"FrameStyle", "\[Rule]", 
            RowBox[{"Directive", "[", "18", "]"}]}], "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{",", 
             RowBox[{"Epilog", "\[Rule]", " ", 
              RowBox[{"{", 
               RowBox[{"Text", "[", 
                RowBox[{
                 RowBox[{"Style", "[", 
                  RowBox[{"\"\<Collisons\>\"", ",", "Large", ",", "Blue"}], 
                  "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"veloc", "[", 
                    RowBox[{
                    "n", ",", "a", ",", "r", ",", "1", ",", "Nmag", ",", 
                    "1"}], "]"}]}], "}"}]}], "]"}], "}"}]}]}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"Epilog", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{"Yellow", ",", 
               RowBox[{"EdgeForm", "[", "Black", "]"}], ",", 
               RowBox[{"PointSize", "\[Rule]", "Large"}], ",", 
               RowBox[{"Point", "[", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "3"}], "}"}], "]"}]}], "}"}]}], "*)"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"Prolog", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"Red", ",", 
              RowBox[{"Line", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1000"}], ",", " ", 
                   RowBox[{"veloc", "[", 
                    RowBox[{
                    "r", ",", "a", ",", "Nmag", ",", "n", ",", "aStep", ",", 
                    "interSteps"}], "]"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"1000", 
                    RowBox[{"ballPos", "[", 
                    RowBox[{
                    "r", ",", "a", ",", "Nmag", ",", "n", ",", "aStep", ",", 
                    "interSteps"}], "]"}]}], ",", 
                   RowBox[{"veloc", "[", 
                    RowBox[{
                    "r", ",", "a", ",", "Nmag", ",", "n", ",", "aStep", ",", 
                    "interSteps"}], "]"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"1000", 
                    RowBox[{"ballPos", "[", 
                    RowBox[{
                    "r", ",", "a", ",", "Nmag", ",", "n", ",", "aStep", ",", 
                    "interSteps"}], "]"}]}], ",", "0"}], "}"}]}], "}"}], 
               "]"}]}], "}"}]}], "\[IndentingNewLine]", ",", 
           RowBox[{"ImageSize", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"wid", ",", "Automatic"}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"1", "/", "3"}]}]}], "\[IndentingNewLine]", "]"}]}], 
        "\[IndentingNewLine]", " ", "}"}], "]"}]}]}], "]"}], 
   "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{"interSteps", ",", " ", 
     RowBox[{"ControlType", "\[Rule]", " ", "None"}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"r", ",", "0.005", ",", "\"\<ball radius (m)\>\""}], "}"}], ",",
      "0.0005", ",", "0.01", ",", 
     RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"a", ",", "8", ",", "\"\<air gap (ball radii)\>\""}], "}"}], 
     ",", 
     RowBox[{"2", 
      RowBox[{"(", 
       RowBox[{"n", "-", "1"}], ")"}]}], ",", "20", ",", 
     RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Nmag", ",", "2", ",", "\"\<stages\>\""}], "}"}], ",", "1", ",",
      "10", ",", "1", ",", 
     RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n", ",", "3", ",", "\"\<balls per stage\>\""}], "}"}], ",", 
     "2", ",", "10", ",", "1", ",", 
     RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"aStep", ",", "0", ",", "\"\<Animate\>\""}], "}"}], ",", "0", 
     ",", 
     RowBox[{"interSteps", "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"interSteps", "+", "n"}], ")"}], "Nmag"}]}], ",", "1", ",", 
     RowBox[{"AnimationDirection", "\[Rule]", "Forward"}], ",", 
     RowBox[{"Appearance", "\[Rule]", "\"\<Open\>\""}]}], "}"}], ",", 
   RowBox[{"AppearanceElements", "\[Rule]", "\"\<Open\>\""}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"SaveDefinitions", "\[Rule]", " ", "True"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.6174547029617434`*^9, 3.617454714192605*^9}, {
   3.617454752079083*^9, 3.6174547672316113`*^9}, {3.617457576825883*^9, 
   3.6174575928867817`*^9}, {3.617814161823691*^9, 3.6178142480449457`*^9}, {
   3.6178143841154623`*^9, 3.617814396677005*^9}, {3.61781445262114*^9, 
   3.617814736665929*^9}, {3.617814795196237*^9, 3.617814880792081*^9}, {
   3.617814922780094*^9, 3.617814936522542*^9}, {3.617819103033011*^9, 
   3.6178191222477016`*^9}, 3.617819227205735*^9, {3.6178193543896713`*^9, 
   3.617819362184473*^9}, 3.617819445530355*^9, {3.617819818541315*^9, 
   3.617819860378655*^9}, {3.617820180809866*^9, 3.617820283854838*^9}, 
   3.6178203296231127`*^9, {3.617820367189843*^9, 3.617820373763194*^9}, {
   3.617820550540184*^9, 3.617820563287545*^9}, {3.617820800875457*^9, 
   3.617820851912484*^9}, {3.617820889704234*^9, 3.617820896477405*^9}, 
   3.617820978722589*^9, {3.617821015953641*^9, 3.617821095984395*^9}, 
   3.617821137598775*^9, {3.617821191778947*^9, 3.617821273866324*^9}, {
   3.617821327771288*^9, 3.617821443483285*^9}, {3.61782147521977*^9, 
   3.617821480767009*^9}, {3.617827755944449*^9, 3.617827763880519*^9}, 
   3.617827857904393*^9, 3.617827896994911*^9, {3.617828084478352*^9, 
   3.6178281066631193`*^9}, {3.61782819385299*^9, 3.6178282011797667`*^9}, {
   3.6179591765022383`*^9, 3.617959209184119*^9}, {3.6179592878656197`*^9, 
   3.617959379436677*^9}, {3.617959421602426*^9, 3.617959482552107*^9}, {
   3.617959547454577*^9, 3.617959581060254*^9}, {3.617959628537272*^9, 
   3.617959642369183*^9}, {3.617959675506217*^9, 3.617959780499118*^9}, {
   3.6179598309410563`*^9, 3.617959834185457*^9}, {3.6179598742511044`*^9, 
   3.6179598922024927`*^9}, {3.6179599552815866`*^9, 3.617959995107527*^9}, {
   3.617960043419197*^9, 3.61796008279629*^9}, {3.617960280305327*^9, 
   3.617960297677414*^9}, {3.61796033326857*^9, 3.617960357114407*^9}, {
   3.6183129612832336`*^9, 3.618313034689784*^9}, {3.618313136838161*^9, 
   3.618313140939762*^9}, {3.618313179547*^9, 3.6183131811364393`*^9}, {
   3.6183132178497477`*^9, 3.6183132194130583`*^9}, {3.618313312004858*^9, 
   3.618313313213132*^9}, {3.6183134082863293`*^9, 3.618313410846789*^9}, {
   3.6183134736180277`*^9, 3.618313473915037*^9}, {3.618313702183085*^9, 
   3.618313702625905*^9}, {3.618314888223068*^9, 3.618314901470113*^9}, {
   3.618315084407844*^9, 3.61831512406703*^9}, {3.618315179803581*^9, 
   3.618315215227646*^9}, {3.618315249742679*^9, 3.618315274217766*^9}, {
   3.618315306762825*^9, 3.61831530755789*^9}, {3.6183153845665913`*^9, 
   3.618315404644771*^9}, {3.6183154667092667`*^9, 3.6183154669730997`*^9}, {
   3.6183155245597153`*^9, 3.6183155687732887`*^9}, {3.61831560061415*^9, 
   3.618315600957123*^9}, {3.6183156383817577`*^9, 3.618315638590605*^9}, 
   3.6183156693873177`*^9, {3.618315706451846*^9, 3.618315763983556*^9}, {
   3.618315797831501*^9, 3.61831593076504*^9}, {3.618438234670376*^9, 
   3.6184382405765457`*^9}, {3.618438336039559*^9, 3.618438351906622*^9}, {
   3.618438466494252*^9, 3.618438473829919*^9}, {3.61843853346423*^9, 
   3.618438559149268*^9}, 3.618438637006975*^9, {3.618438671110067*^9, 
   3.6184386763072767`*^9}, {3.618438710222258*^9, 3.6184387725838127`*^9}, {
   3.618438835108387*^9, 3.618438853036276*^9}, {3.61843888823919*^9, 
   3.618438913866881*^9}, {3.6186066109392767`*^9, 3.6186066164012423`*^9}, {
   3.618606707735825*^9, 3.61860673175471*^9}, {3.618606786416422*^9, 
   3.61860681003906*^9}, {3.618647174736285*^9, 3.618647537555564*^9}, {
   3.6186483584075527`*^9, 3.618648499802384*^9}, {3.618689364676195*^9, 
   3.618689455143523*^9}, {3.618689510183406*^9, 3.618689520008863*^9}, {
   3.618689680376751*^9, 3.6186896922869987`*^9}, {3.61868974013824*^9, 
   3.618689740399493*^9}, {3.618689795162006*^9, 3.618689795733613*^9}, {
   3.618689845446323*^9, 3.6186898911102667`*^9}, {3.618690002303701*^9, 
   3.618690090700935*^9}, {3.6186901240389633`*^9, 3.618690124301112*^9}, {
   3.6186902876065683`*^9, 3.618690363624654*^9}, {3.618690569684964*^9, 
   3.618690599432577*^9}, {3.618690683483267*^9, 3.6186906875103407`*^9}, {
   3.618690732743752*^9, 3.618690733348872*^9}, {3.618690781807254*^9, 
   3.618690782133515*^9}, {3.6186908586795893`*^9, 3.618690949663961*^9}, {
   3.6186909995988073`*^9, 3.618691011510819*^9}, {3.618691047125395*^9, 
   3.6186910990588007`*^9}, {3.618691149550366*^9, 3.618691258651575*^9}, {
   3.6186913088177643`*^9, 3.618691392934318*^9}, {3.618691459731372*^9, 
   3.618691461616254*^9}, {3.618691745726323*^9, 3.6186917464354897`*^9}, {
   3.618692018725031*^9, 3.618692032334763*^9}, {3.618692476235392*^9, 
   3.6186924769497623`*^9}, {3.618692621350019*^9, 3.6186926217918367`*^9}, {
   3.618692718486371*^9, 3.618692730621421*^9}, {3.618692782581242*^9, 
   3.6186927908924227`*^9}, {3.6186928282072763`*^9, 3.618692883282173*^9}, {
   3.618692922017374*^9, 3.618692922469288*^9}, {3.618692969025194*^9, 
   3.618693007660314*^9}, {3.618693111533263*^9, 3.618693121302891*^9}, {
   3.6186931525730543`*^9, 3.61869320138266*^9}, {3.618693239770238*^9, 
   3.6186933657628202`*^9}, {3.6186935045543747`*^9, 
   3.6186935623660994`*^9}, {3.618693640091762*^9, 3.61869372527061*^9}, {
   3.618693756798903*^9, 3.618693947779374*^9}, 3.6186939951460648`*^9, {
   3.618694071701563*^9, 3.618694075761047*^9}, {3.618694106254878*^9, 
   3.618694133351131*^9}, {3.6186941775403852`*^9, 3.618694251019438*^9}, {
   3.618694708604052*^9, 3.618694716930509*^9}, {3.618694823286509*^9, 
   3.6186948283654423`*^9}, {3.618695080653688*^9, 3.618695138007825*^9}, {
   3.618695388213625*^9, 3.618695391510824*^9}, {3.618695566190531*^9, 
   3.618695566566978*^9}, {3.618695668626095*^9, 3.61869566968852*^9}, {
   3.618695702177991*^9, 3.618695706235643*^9}, {3.6186957377432117`*^9, 
   3.618695788394806*^9}, 3.618695825214732*^9, {3.6186959137427683`*^9, 
   3.618695936277692*^9}, {3.6186962580337563`*^9, 3.618696272091798*^9}, {
   3.6186966228570423`*^9, 3.6186966623685713`*^9}, {3.6186966946397247`*^9, 
   3.618696703917056*^9}, {3.618697299496586*^9, 3.618697300209736*^9}, {
   3.6186977306890574`*^9, 3.618697779528674*^9}, {3.6186978328306417`*^9, 
   3.618698092497513*^9}, {3.618698198945763*^9, 3.618698282951894*^9}, {
   3.618698325691546*^9, 3.618698363901144*^9}, {3.6186984216461153`*^9, 
   3.6186984687261257`*^9}, {3.618698548071431*^9, 3.618698785934074*^9}, {
   3.618699013328332*^9, 3.6186990198138657`*^9}, {3.618867405412673*^9, 
   3.6188674855826817`*^9}, 3.618914075604022*^9, {3.6189141508113613`*^9, 
   3.618914249875072*^9}, {3.6189143379320498`*^9, 3.618914457479513*^9}, {
   3.6193707445977907`*^9, 3.619370745552272*^9}, {3.619370799012257*^9, 
   3.619370942784401*^9}, {3.6193710244305773`*^9, 3.619371041187752*^9}, {
   3.619371080846471*^9, 3.6193710837495737`*^9}, {3.619371138296212*^9, 
   3.619371163914654*^9}, {3.619371200250119*^9, 3.619371227689797*^9}, 
   3.6193712891047373`*^9, {3.61937139092776*^9, 3.619371394456061*^9}, {
   3.619372021503151*^9, 3.619372029437314*^9}, {3.619372217261546*^9, 
   3.619372269873322*^9}, {3.6193723712173557`*^9, 3.6193724131916027`*^9}, {
   3.619372461045587*^9, 3.619372482397304*^9}, {3.6193853149400597`*^9, 
   3.619385340900379*^9}, 3.6193854562415648`*^9, {3.619385552148078*^9, 
   3.6193856851298637`*^9}, {3.619385736783152*^9, 3.619385823016635*^9}, {
   3.61938588376163*^9, 3.619385912022423*^9}, {3.619385964107465*^9, 
   3.619386024756681*^9}, {3.619386113443129*^9, 3.619386124872137*^9}, {
   3.619386219120983*^9, 3.6193862555620747`*^9}, {3.619386392731389*^9, 
   3.619386393681611*^9}}],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`a$$ = 4, $CellContext`aStep$$ = 
    16, $CellContext`interSteps$$ = 4, $CellContext`n$$ = 
    2, $CellContext`Nmag$$ = 2, $CellContext`r$$ = 0.0005, Typeset`show$$ = 
    True, Typeset`bookmarkList$$ = {}, Typeset`bookmarkMode$$ = "Menu", 
    Typeset`animator$$, Typeset`animvar$$ = 1, Typeset`name$$ = 
    "\"untitled\"", Typeset`specs$$ = {{
      Hold[$CellContext`interSteps$$]}, {{
       Hold[$CellContext`r$$], 0.005, "ball radius (m)"}, 0.0005, 0.01}, {{
       Hold[$CellContext`a$$], 8, "air gap (ball radii)"}, 
      Dynamic[2 ($CellContext`n$$ - 1)], 20}, {{
       Hold[$CellContext`Nmag$$], 2, "stages"}, 1, 10, 1}, {{
       Hold[$CellContext`n$$], 3, "balls per stage"}, 2, 10, 1}, {{
       Hold[$CellContext`aStep$$], 0, "Animate"}, 0, 
      Dynamic[$CellContext`interSteps$$ + ($CellContext`interSteps$$ + \
$CellContext`n$$) $CellContext`Nmag$$], 1}}, Typeset`size$$ = {
    500., {207.134033203125, 212.865966796875}}, Typeset`update$$ = 0, 
    Typeset`initDone$$, Typeset`skipInitDone$$ = 
    False, $CellContext`r$1165$$ = 0, $CellContext`a$1166$$ = 
    0, $CellContext`Nmag$1167$$ = 0, $CellContext`n$1168$$ = 
    0, $CellContext`aStep$1169$$ = 0}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`a$$ = 8, $CellContext`aStep$$ = 
        0, $CellContext`interSteps$$ = Null, $CellContext`n$$ = 
        3, $CellContext`Nmag$$ = 2, $CellContext`r$$ = 0.005}, 
      "ControllerVariables" :> {
        Hold[$CellContext`r$$, $CellContext`r$1165$$, 0], 
        Hold[$CellContext`a$$, $CellContext`a$1166$$, 0], 
        Hold[$CellContext`Nmag$$, $CellContext`Nmag$1167$$, 0], 
        Hold[$CellContext`n$$, $CellContext`n$1168$$, 0], 
        Hold[$CellContext`aStep$$, $CellContext`aStep$1169$$, 0]}, 
      "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, "Body" :> 
      Module[{$CellContext`ofset$, $CellContext`magposes$, \
$CellContext`ballposes$, $CellContext`collpos$, $CellContext`stage$, \
$CellContext`velocity$, $CellContext`textPos$, $CellContext`interStepsFine$ = 
         20, $CellContext`maxVel$, $CellContext`wid$ = 
         500}, $CellContext`interSteps$$ = 4; 
        If[$CellContext`a$$ < 2 ($CellContext`n$$ - 1), $CellContext`a$$ = 
          2 ($CellContext`n$$ - 1)]; 
        If[$CellContext`aStep$$ > $CellContext`interSteps$$ + \
($CellContext`interSteps$$ + $CellContext`n$$) $CellContext`Nmag$$, \
$CellContext`aStep$$ = $CellContext`interSteps$$ + ($CellContext`interSteps$$ + \
$CellContext`n$$) $CellContext`Nmag$$]; Column[{
           Graphics[{White, 
             
             Rectangle[{(-(8 + $CellContext`a$$)) $CellContext`r$$, 
               0}, {$CellContext`Nmag$$ 
                2 ($CellContext`a$$/2 + 
                 1 + $CellContext`n$$) $CellContext`r$$ - (
                1 + $CellContext`a$$) $CellContext`r$$ + 0.1, 
               2 $CellContext`r$$}], 
             EdgeForm[Black], Brown, 
             
             Rectangle[{(-(
                 4 + $CellContext`a$$)) $CellContext`r$$, (-8) \
$CellContext`r$$}, {$CellContext`Nmag$$ 
                2 ($CellContext`a$$/2 + 
                 1 + $CellContext`n$$) $CellContext`r$$ - (
                1 + $CellContext`a$$) $CellContext`r$$, -$CellContext`r$$}], \
$CellContext`magposes$ = $CellContext`MagPos[$CellContext`r$$, \
$CellContext`a$$, $CellContext`Nmag$$, $CellContext`n$$]; Table[{
                $CellContext`DrawMagnet[
                 
                 Part[$CellContext`magposes$, $CellContext`j], \
$CellContext`r$$], 
                Table[
                 $CellContext`DrawBall[
                 Part[$CellContext`magposes$, $CellContext`j] + \
$CellContext`balls 2 $CellContext`r$$, $CellContext`r$$], {$CellContext`balls,
                   1, $CellContext`n$$ - 1}]}, {$CellContext`j, 1, 
                
                Length[$CellContext`magposes$]}], $CellContext`velocity$ = \
$CellContext`veloc[$CellContext`r$$, $CellContext`a$$, $CellContext`Nmag$$, \
$CellContext`n$$, $CellContext`aStep$$, $CellContext`interSteps$$]; \
$CellContext`ballposes$ = $CellContext`PosAfterANIMATE[$CellContext`r$$, \
$CellContext`a$$, $CellContext`Nmag$$, $CellContext`n$$, \
$CellContext`aStep$$, $CellContext`interSteps$$]; Table[
               $CellContext`DrawBall[
                
                Part[$CellContext`ballposes$, $CellContext`j], \
$CellContext`r$$], {$CellContext`j, 1, 
                Length[$CellContext`ballposes$]}], 
             
             If[$CellContext`ofset$ = 
               Mod[$CellContext`aStep$$ - 
                  1, $CellContext`interSteps$$ + $CellContext`n$$] - \
$CellContext`interSteps$$ + 1; $CellContext`stage$ = Max[0, 
                 
                 Floor[($CellContext`aStep$$ - 
                   1)/($CellContext`interSteps$$ + $CellContext`n$$)]]; \
$CellContext`collpos$ = (2 $CellContext`ofset$ - 1 + 
                 2 ($CellContext`a$$/2 + $CellContext`n$$ + 
                   1) $CellContext`stage$) $CellContext`r$$; 
              And[$CellContext`ofset$ >= 0, $CellContext`aStep$$ > 
                1, $CellContext`aStep$$ <= $CellContext`Nmag$$ \
($CellContext`interSteps$$ + $CellContext`n$$)], {
               $CellContext`DrawCollision[$CellContext`collpos$, \
$CellContext`r$$], $CellContext`textPos$ = $CellContext`collpos$ + \
$CellContext`r$$; 
               Null}, {$CellContext`textPos$ = (-$CellContext`a$$ - 
                  2 + (2 + 
                    2 $CellContext`n$$ + $CellContext`a$$) \
$CellContext`stage$ + $CellContext`a$$ Max[0, 
                    
                    Min[($CellContext`aStep$$ - $CellContext`stage$ \
($CellContext`interSteps$$ + $CellContext`n$$))/$CellContext`interSteps$$, 
                    1]]) $CellContext`r$$; Null}], {Black, 
              Text[
               Style[
                StringForm["``m/s", 
                 NumberForm[
                  Chop[$CellContext`velocity$], 3]], 
                20], {$CellContext`textPos$, $CellContext`r$$}, {
               Center, Bottom}]}, Null, 
             Darker[Gray], 
             Table[
              
              Line[{{$CellContext`x/
                 10, (-8) $CellContext`r$$}, {$CellContext`x/
                 10, -$CellContext`r$$}}], {$CellContext`x, 0, 
               Floor[
               10 ($CellContext`Nmag$$ 
                   2 ($CellContext`a$$/2 + 
                    1 + $CellContext`n$$) $CellContext`r$$ - (
                   1 + $CellContext`a$$) $CellContext`r$$) + 1]}], 
             Arrowheads[{-0.03, 0.03}], 
             
             Arrow[{{0, (-4) $CellContext`r$$}, {
               1/10, (-4) $CellContext`r$$}}], 
             Text[
              Style["100mm", 20], {1/20, (-5) $CellContext`r$$}, {
              Center, Top}], Null}, ImageSize -> {$CellContext`wid$, 200}], 
           ListPlot[{
             
             Table[{1000 $CellContext`ballPos[$CellContext`r$$, \
$CellContext`a$$, $CellContext`Nmag$$, $CellContext`n$$, $CellContext`aStep2, \
$CellContext`interStepsFine$], 
               $CellContext`veloc[$CellContext`r$$, $CellContext`a$$, \
$CellContext`Nmag$$, $CellContext`n$$, $CellContext`aStep2, \
$CellContext`interStepsFine$]}, {$CellContext`aStep2, 
               0, $CellContext`interStepsFine$ + \
($CellContext`interStepsFine$ + $CellContext`n$$) $CellContext`Nmag$$}], 
             
             Table[{1000 $CellContext`ballPos[$CellContext`r$$, \
$CellContext`a$$, $CellContext`Nmag$$, $CellContext`n$$, $CellContext`aStep2, 
                 1], 
               $CellContext`veloc[$CellContext`r$$, $CellContext`a$$, \
$CellContext`Nmag$$, $CellContext`n$$, $CellContext`aStep2, 
                1]}, {$CellContext`aStep2, 1, 
               1 + (1 + $CellContext`n$$) $CellContext`Nmag$$ - 1}]}, 
            Joined -> {True, False}, 
            PlotRange -> {{
              Automatic, 
               1000 ($CellContext`Nmag$$ 
                 2 ($CellContext`a$$/2 + 
                  1 + $CellContext`n$$) $CellContext`r$$ - (
                 1 + $CellContext`a$$) $CellContext`r$$ + 0.1)}, Automatic}, 
            MeshStyle -> PointSize[Large], PlotStyle -> {Thick, {
               PointSize[Large], Blue}}, 
            AxesOrigin -> {
             1000 ((-$CellContext`a$$) $CellContext`r$$ - 2 $CellContext`r$$),
               0}, Frame -> {True, True, False, False}, 
            FrameLabel -> {"Moving Ball position (mm)", "Velocity (m/s)"}, 
            FrameStyle -> Directive[18], Prolog -> {Red, 
              Line[{{-1000, 
                 $CellContext`veloc[$CellContext`r$$, $CellContext`a$$, \
$CellContext`Nmag$$, $CellContext`n$$, $CellContext`aStep$$, \
$CellContext`interSteps$$]}, {
                1000 $CellContext`ballPos[$CellContext`r$$, $CellContext`a$$, \
$CellContext`Nmag$$, $CellContext`n$$, $CellContext`aStep$$, \
$CellContext`interSteps$$], 
                 $CellContext`veloc[$CellContext`r$$, $CellContext`a$$, \
$CellContext`Nmag$$, $CellContext`n$$, $CellContext`aStep$$, \
$CellContext`interSteps$$]}, {
                1000 $CellContext`ballPos[$CellContext`r$$, $CellContext`a$$, \
$CellContext`Nmag$$, $CellContext`n$$, $CellContext`aStep$$, \
$CellContext`interSteps$$], 0}}]}, 
            ImageSize -> {$CellContext`wid$, Automatic}, AspectRatio -> 
            1/3]}]], 
      "Specifications" :> {{$CellContext`interSteps$$, ControlType -> 
         None}, {{$CellContext`r$$, 0.005, "ball radius (m)"}, 0.0005, 0.01, 
         Appearance -> 
         "Labeled"}, {{$CellContext`a$$, 8, "air gap (ball radii)"}, 
         Dynamic[2 ($CellContext`n$$ - 1)], 20, Appearance -> 
         "Labeled"}, {{$CellContext`Nmag$$, 2, "stages"}, 1, 10, 1, 
         Appearance -> "Labeled"}, {{$CellContext`n$$, 3, "balls per stage"}, 
         2, 10, 1, Appearance -> 
         "Labeled"}, {{$CellContext`aStep$$, 0, "Animate"}, 0, 
         Dynamic[$CellContext`interSteps$$ + ($CellContext`interSteps$$ + \
$CellContext`n$$) $CellContext`Nmag$$], 1, AnimationDirection -> Forward, 
         Appearance -> "Open"}}, "Options" :> {AppearanceElements -> "Open"}, 
      "DefaultOptions" :> {}],
     ImageSizeCache->{545., {354., 360.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    Initialization:>({$CellContext`MagPos[
         Pattern[$CellContext`r, 
          Blank[]], 
         Pattern[$CellContext`a, 
          Blank[]], 
         Pattern[$CellContext`Nmag, 
          Blank[]], 
         Pattern[$CellContext`n, 
          Blank[]]] := 
       Table[(2 + 
          2 $CellContext`n + $CellContext`a) $CellContext`r $CellContext`k, \
{$CellContext`k, 0, $CellContext`Nmag - 1}], $CellContext`DrawMagnet[
         Pattern[$CellContext`x, 
          Blank[]], 
         Pattern[$CellContext`r, 
          Blank[]]] := {Red, 
         Disk[{$CellContext`x, 0}, $CellContext`r], Green, 
         Disk[{$CellContext`x, 0}, $CellContext`r, {-(Pi/2), Pi/
           2}]}, $CellContext`DrawBall[
         Pattern[$CellContext`x, 
          Blank[]], 
         Pattern[$CellContext`r, 
          Blank[]]] := {Gray, 
         Disk[{$CellContext`x, 0}, $CellContext`r]}, $CellContext`veloc[
         Pattern[$CellContext`r, 
          Blank[]], 
         Pattern[$CellContext`a, 
          Blank[]], 
         Pattern[$CellContext`Nmag, 
          Blank[]], 
         Pattern[$CellContext`n, 
          Blank[]], 
         Pattern[$CellContext`aStep, 
          Blank[]], 
         Pattern[$CellContext`interSteps, 
          Blank[]]] := $CellContext`PEtoVelocity[
         Chop[$CellContext`PEAfterANIMATE[$CellContext`r, $CellContext`a, \
$CellContext`Nmag, $CellContext`n, $CellContext`aStep, \
$CellContext`interSteps] - $CellContext`PEBefore[$CellContext`r, \
$CellContext`a, $CellContext`Nmag, $CellContext`n]], 
         $CellContext`massCapsule[$CellContext`r]], $CellContext`PEtoVelocity[
        
         Pattern[$CellContext`\[CapitalDelta]PE, 
          Blank[]], 
         Pattern[$CellContext`m, 
          Blank[]]] := Max[0, 
         Re[
          
          Sqrt[(2 $CellContext`\[CapitalDelta]PE)/$CellContext`m]]], \
$CellContext`PEAfterANIMATE[
         Pattern[$CellContext`r, 
          Blank[]], 
         Pattern[$CellContext`a, 
          Blank[]], 
         Pattern[$CellContext`Nmag, 
          Blank[]], 
         Pattern[$CellContext`n, 
          Blank[]], 
         Pattern[$CellContext`aStep, 
          Blank[]], 
         Pattern[$CellContext`interSteps, 
          Blank[]]] := 
       Module[{$CellContext`PA = $CellContext`PosAfterANIMATE[$CellContext`r, \
$CellContext`a, $CellContext`Nmag, $CellContext`n, $CellContext`aStep, \
$CellContext`interSteps]}, 
         Total[
          Table[
           $CellContext`PEenergy[$CellContext`r, 
            Abs[
            Part[$CellContext`PA, $CellContext`j] - \
$CellContext`MagPos[$CellContext`r, $CellContext`a, $CellContext`Nmag, \
$CellContext`n]]], {$CellContext`j, 1, 
            Length[$CellContext`PA]}], 2]], $CellContext`PosAfterANIMATE[
         Pattern[$CellContext`r, 
          Blank[]], 
         Pattern[$CellContext`a, 
          Blank[]], 
         Pattern[$CellContext`Nmag, 
          Blank[]], 
         Pattern[$CellContext`n, 
          Blank[]], 
         Pattern[$CellContext`aStep, 
          Blank[]], 
         Pattern[$CellContext`interSteps, 
          Blank[]]] := 
       Table[(-$CellContext`a - 
          2 + (2 + 
            2 $CellContext`n + $CellContext`a) $CellContext`k + \
$CellContext`a Max[0, 
             
             Min[($CellContext`aStep - $CellContext`k \
($CellContext`interSteps + $CellContext`n))/$CellContext`interSteps, 
              1]]) $CellContext`r, {$CellContext`k, 
          0, $CellContext`Nmag}], $CellContext`PEenergy[
         Pattern[$CellContext`r, 
          Blank[]], 
         Pattern[$CellContext`d, 
          Blank[]]] := ((6.490602773423956*^6/
          2) $CellContext`r^6)/$CellContext`d^3, $CellContext`PEBefore[
         Pattern[$CellContext`r, 
          Blank[]], 
         Pattern[$CellContext`a, 
          Blank[]], 
         Pattern[$CellContext`Nmag, 
          Blank[]], 
         Pattern[$CellContext`n, 
          Blank[]]] := 
       Module[{$CellContext`Pb = $CellContext`PosBefore[$CellContext`r, \
$CellContext`a, $CellContext`Nmag, $CellContext`n]}, 
         Total[
          Table[
           $CellContext`PEenergy[$CellContext`r, 
            Abs[
            Part[$CellContext`Pb, $CellContext`j] - \
$CellContext`MagPos[$CellContext`r, $CellContext`a, $CellContext`Nmag, \
$CellContext`n]]], {$CellContext`j, 1, 
            Length[$CellContext`Pb]}], 2]], $CellContext`PosBefore[
         Pattern[$CellContext`r, 
          Blank[]], 
         Pattern[$CellContext`a, 
          Blank[]], 
         Pattern[$CellContext`Nmag, 
          Blank[]], 
         Pattern[$CellContext`n, 
          Blank[]]] := 
       Table[(-$CellContext`a - 
          2 + (2 + 
            2 $CellContext`n + $CellContext`a) $CellContext`k) \
$CellContext`r, {$CellContext`k, 
          0, $CellContext`Nmag}], $CellContext`massCapsule[
         Pattern[$CellContext`rad, 
          Blank[]]] := (4/3) Pi $CellContext`rad^3 
        7850, $CellContext`DrawCollision[
         Pattern[$CellContext`x, 
          Blank[]], 
         Pattern[$CellContext`r, 
          Blank[]]] := {Yellow, 
         Module[{$CellContext`kmax = 16}, 
          Polygon[
           
           Table[$CellContext`\[Theta] = 
             2 ((Pi $CellContext`k)/$CellContext`kmax) + 
              RandomReal[(2 Pi)/$CellContext`kmax]; {$CellContext`x, 
               0} + $CellContext`r 0.8 {
                Sin[$CellContext`\[Theta]], 2 Cos[$CellContext`\[Theta]]} If[
                EvenQ[$CellContext`k], 1, 1/3], {$CellContext`k, 
             1, $CellContext`kmax}]]]}, $CellContext`ballPos[
         Pattern[$CellContext`r, 
          Blank[]], 
         Pattern[$CellContext`a, 
          Blank[]], 
         Pattern[$CellContext`Nmag, 
          Blank[]], 
         Pattern[$CellContext`n, 
          Blank[]], 
         Pattern[$CellContext`aStep, 
          Blank[]], 
         Pattern[$CellContext`interSteps, 
          Blank[]]] := 
       Module[{$CellContext`ofset, $CellContext`stage, $CellContext`collpos}, 
         
         If[$CellContext`ofset = 
           Mod[$CellContext`aStep - 
              1, $CellContext`interSteps + $CellContext`n] - \
$CellContext`interSteps + 1; $CellContext`stage = Max[0, 
             
             Floor[($CellContext`aStep - 
               1)/($CellContext`interSteps + $CellContext`n)]]; \
$CellContext`collpos = (2 $CellContext`ofset - 1 + 
             2 ($CellContext`a/2 + $CellContext`n + 
               1) $CellContext`stage) $CellContext`r; 
          And[$CellContext`ofset >= 0, $CellContext`aStep > 
            1, $CellContext`aStep <= $CellContext`Nmag \
($CellContext`interSteps + $CellContext`n)], $CellContext`collpos - \
$CellContext`r, (-$CellContext`a - 
           2 + (2 + 
             2 $CellContext`n + $CellContext`a) $CellContext`stage + \
$CellContext`a Max[0, 
              
              Min[($CellContext`aStep - $CellContext`stage \
($CellContext`interSteps + $CellContext`n))/$CellContext`interSteps, 
               1]]) $CellContext`r]]}; Typeset`initDone$$ = True),
    SynchronousInitialization->True,
    UndoTrackedVariables:>{Typeset`show$$, Typeset`bookmarkMode$$},
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{
  3.6186939694181137`*^9, {3.618694057508703*^9, 3.6186940768666286`*^9}, 
   3.618694255479927*^9, 3.6186942915864267`*^9, 3.618694717625581*^9, 
   3.618694829107511*^9, {3.6186949089982033`*^9, 3.618694926443297*^9}, {
   3.618695099142469*^9, 3.61869513866195*^9}, 3.6186953924656076`*^9, 
   3.618695567655284*^9, {3.618695718453661*^9, 3.618695740178442*^9}, 
   3.6186957889891*^9, 3.618695825893731*^9, {3.618695916078232*^9, 
   3.618695937037034*^9}, 3.6186962589963427`*^9, 3.618696301945939*^9, {
   3.61869664523814*^9, 3.6186966635526857`*^9}, 3.6186967050611*^9, {
   3.6186973085288143`*^9, 3.618697315567767*^9}, {3.618697772957353*^9, 
   3.618697780220008*^9}, {3.6186979089308043`*^9, 3.618697946733358*^9}, {
   3.61869800974232*^9, 3.618698092861199*^9}, 3.618698238683249*^9, 
   3.618698275466928*^9, {3.618698336022134*^9, 3.61869836463666*^9}, 
   3.618698431728544*^9, 3.618698469725884*^9, 3.6186985645371857`*^9, {
   3.618698616146949*^9, 3.618698638356749*^9}, {3.6186986712478523`*^9, 
   3.61869878724008*^9}, 3.618699020873876*^9, {3.618867422744381*^9, 
   3.618867486111683*^9}, 3.6189140764136333`*^9, 3.618914184486505*^9, {
   3.618914235352062*^9, 3.618914250196697*^9}, 3.618914458308467*^9, {
   3.619370696577834*^9, 3.6193707212540894`*^9}, 3.619370755515519*^9, {
   3.619370799745092*^9, 3.619370920785429*^9}, {3.6193710303545523`*^9, 
   3.619371041892837*^9}, 3.61937108455823*^9, 3.619371164714823*^9, 
   3.619371201168707*^9, 3.6193712593955183`*^9, 3.61937136582651*^9, 
   3.619371994514933*^9, 3.619372050973884*^9, 3.61937228357146*^9, 
   3.619372439169931*^9, 3.6193727190956087`*^9, 3.619373118443028*^9, 
   3.619385457706002*^9, 3.61938555330993*^9, {3.619385610652585*^9, 
   3.61938564008005*^9}, 3.6193856858038607`*^9, 3.619385738674753*^9, {
   3.6193857791123*^9, 3.619385823772999*^9}, {3.6193859031891336`*^9, 
   3.6193859125788107`*^9}, {3.619385966916253*^9, 3.619386025397546*^9}, 
   3.619386256264392*^9, 3.6193862914212217`*^9, 3.638640490391905*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Manipulate", "[", 
  RowBox[{
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "ofset", ",", "magposes", ",", "ballposes", ",", "collpos", ",", 
       "stage", ",", "velocity", ",", "textPos", ",", 
       RowBox[{"interStepsFine", "=", "50"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"interSteps", "=", "4"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", " ", 
       RowBox[{
        RowBox[{"a", "<", 
         RowBox[{"2", 
          RowBox[{"(", 
           RowBox[{"n", "-", "1"}], ")"}]}]}], ",", 
        RowBox[{"a", "=", 
         RowBox[{"2", 
          RowBox[{"(", 
           RowBox[{"n", "-", "1"}], ")"}]}]}]}], "]"}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"if", " ", "a"}], "<", 
         RowBox[{"2", 
          RowBox[{"(", 
           RowBox[{"n", "-", "1"}], ")"}]}]}], ",", " ", 
        RowBox[{
        "the", " ", "starting", " ", "configuration", " ", "is", " ", "not", 
         " ", "stable"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"aStep", ">", 
         RowBox[{"interSteps", "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"interSteps", "+", "n"}], ")"}], "Nmag"}]}]}], ",", 
        RowBox[{"aStep", "=", 
         RowBox[{"interSteps", "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"interSteps", "+", "n"}], ")"}], "Nmag"}]}]}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"ballPos", "[", 
               RowBox[{
               "r", ",", "a", ",", "Nmag", ",", "n", ",", "aStep2", ",", 
                "interStepsFine"}], "]"}], ",", 
              RowBox[{"veloc", "[", 
               RowBox[{
               "r", ",", "a", ",", "Nmag", ",", "n", ",", "aStep2", ",", 
                "interStepsFine"}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"aStep2", ",", "0", ",", 
              RowBox[{"interStepsFine", "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"interStepsFine", "+", "n"}], ")"}], "Nmag"}]}]}], 
             "}"}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"ballPos", "[", 
               RowBox[{
               "r", ",", "a", ",", "Nmag", ",", "n", ",", "aStep2", ",", 
                "1"}], "]"}], ",", 
              RowBox[{"veloc", "[", 
               RowBox[{
               "r", ",", "a", ",", "Nmag", ",", "n", ",", "aStep2", ",", 
                "1"}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"aStep2", ",", "1", ",", 
              RowBox[{"1", "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"1", "+", "n"}], ")"}], "Nmag"}], "-", "1"}]}], 
             "}"}]}], "]"}]}], "\[IndentingNewLine]", "}"}], ",", 
        RowBox[{"Joined", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"True", ",", "False"}], "}"}]}], ",", 
        RowBox[{"PlotRange", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Automatic", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"(", "Nmag", ")"}], " ", "2", 
               RowBox[{"(", 
                RowBox[{
                 FractionBox["a", "2"], "+", "1", "+", "n"}], ")"}], "r"}], 
              "-", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"1", "+", "a"}], ")"}], " ", "r"}], "+", "0.1"}]}], 
            "}"}], ",", "Automatic"}], "}"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"MeshStyle", "\[Rule]", 
         RowBox[{"PointSize", "[", "Large", "]"}]}], 
        RowBox[{"(*", 
         RowBox[{",", 
          RowBox[{"PlotMarkers", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"\"\<\>\"", ",", 
             RowBox[{"{", 
              RowBox[{
               StyleBox["\[FivePointedStar]",
                FontColor->RGBColor[1, 0, 1]], ",", "20"}], "}"}]}], 
            "}"}]}]}], "*)"}], ",", 
        RowBox[{"PlotStyle", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"Thick", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"PointSize", "[", "Large", "]"}], ",", "Blue"}], "}"}]}],
           "}"}]}], ",", 
        RowBox[{"AxesOrigin", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"-", "a"}], " ", "r"}], "-", 
            RowBox[{"2", "r"}]}], ",", "0"}], "}"}]}], ",", 
        RowBox[{"Frame", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"True", ",", "True", ",", "False", ",", "False"}], "}"}]}], 
        ",", 
        RowBox[{"FrameLabel", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
          "\"\<Moving Ball position (m)\>\"", ",", "\"\<Velocity (m/s)\>\""}],
           "}"}]}], ",", 
        RowBox[{"FrameStyle", "\[Rule]", 
         RowBox[{"Directive", "[", "18", "]"}]}], "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{",", 
          RowBox[{"Epilog", "\[Rule]", " ", 
           RowBox[{"{", 
            RowBox[{"Text", "[", 
             RowBox[{
              RowBox[{"Style", "[", 
               RowBox[{"\"\<Collisons\>\"", ",", "Large", ",", "Blue"}], 
               "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"veloc", "[", 
                 RowBox[{
                 "n", ",", "a", ",", "r", ",", "1", ",", "Nmag", ",", "1"}], 
                 "]"}]}], "}"}]}], "]"}], "}"}]}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Epilog", "\[Rule]", " ", 
          RowBox[{"{", 
           RowBox[{"Yellow", ",", 
            RowBox[{"EdgeForm", "[", "Black", "]"}], ",", 
            RowBox[{"PointSize", "\[Rule]", "Large"}], ",", 
            RowBox[{"Point", "[", 
             RowBox[{"{", 
              RowBox[{"0", ",", "3"}], "}"}], "]"}]}], "}"}]}], "*)"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"Prolog", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"Red", ",", 
           RowBox[{"Line", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1"}], ",", " ", 
                RowBox[{"veloc", "[", 
                 RowBox[{
                 "r", ",", "a", ",", "Nmag", ",", "n", ",", "aStep", ",", 
                  "interSteps"}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"ballPos", "[", 
                 RowBox[{
                 "r", ",", "a", ",", "Nmag", ",", "n", ",", "aStep", ",", 
                  "interSteps"}], "]"}], ",", 
                RowBox[{"veloc", "[", 
                 RowBox[{
                 "r", ",", "a", ",", "Nmag", ",", "n", ",", "aStep", ",", 
                  "interSteps"}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"ballPos", "[", 
                 RowBox[{
                 "r", ",", "a", ",", "Nmag", ",", "n", ",", "aStep", ",", 
                  "interSteps"}], "]"}], ",", "0"}], "}"}]}], "}"}], "]"}]}], 
          "}"}]}], "\[IndentingNewLine]", ",", 
        RowBox[{"ImageSize", "\[Rule]", "Large"}]}], "\[IndentingNewLine]", 
       "]"}]}]}], "]"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"r", ",", "0.005", ",", "\"\<ball radius (m)\>\""}], "}"}], ",",
      "0.0005", ",", "0.01", ",", 
     RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"a", ",", "8", ",", "\"\<air gap (ball radii)\>\""}], "}"}], 
     ",", 
     RowBox[{"2", 
      RowBox[{"(", 
       RowBox[{"n", "-", "1"}], ")"}]}], ",", "20", ",", 
     RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"Nmag", ",", "2", ",", "\"\<stages\>\""}], "}"}], ",", "1", ",",
      "10", ",", "1", ",", 
     RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n", ",", "3", ",", "\"\<balls per stage\>\""}], "}"}], ",", 
     "2", ",", "10", ",", "1", ",", 
     RowBox[{"Appearance", "\[Rule]", "\"\<Labeled\>\""}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"aStep", ",", "0", ",", "\"\<Animate\>\""}], "}"}], ",", "0", 
     ",", 
     RowBox[{"interSteps", "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"interSteps", "+", "n"}], ")"}], "Nmag"}]}], ",", "1", ",", 
     RowBox[{"AnimationDirection", "\[Rule]", "Forward"}], ",", 
     RowBox[{"Appearance", "\[Rule]", "\"\<Open\>\""}]}], "}"}], ",", 
   RowBox[{"AppearanceElements", "\[Rule]", "\"\<Open\>\""}]}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.6174547029617434`*^9, 3.617454714192605*^9}, {
   3.617454752079083*^9, 3.6174547672316113`*^9}, {3.617457576825883*^9, 
   3.6174575928867817`*^9}, {3.617814161823691*^9, 3.6178142480449457`*^9}, {
   3.6178143841154623`*^9, 3.617814396677005*^9}, {3.61781445262114*^9, 
   3.617814736665929*^9}, {3.617814795196237*^9, 3.617814880792081*^9}, {
   3.617814922780094*^9, 3.617814936522542*^9}, {3.617819103033011*^9, 
   3.6178191222477016`*^9}, 3.617819227205735*^9, {3.6178193543896713`*^9, 
   3.617819362184473*^9}, 3.617819445530355*^9, {3.617819818541315*^9, 
   3.617819860378655*^9}, {3.617820180809866*^9, 3.617820283854838*^9}, 
   3.6178203296231127`*^9, {3.617820367189843*^9, 3.617820373763194*^9}, {
   3.617820550540184*^9, 3.617820563287545*^9}, {3.617820800875457*^9, 
   3.617820851912484*^9}, {3.617820889704234*^9, 3.617820896477405*^9}, 
   3.617820978722589*^9, {3.617821015953641*^9, 3.617821095984395*^9}, 
   3.617821137598775*^9, {3.617821191778947*^9, 3.617821273866324*^9}, {
   3.617821327771288*^9, 3.617821443483285*^9}, {3.61782147521977*^9, 
   3.617821480767009*^9}, {3.617827755944449*^9, 3.617827763880519*^9}, 
   3.617827857904393*^9, 3.617827896994911*^9, {3.617828084478352*^9, 
   3.6178281066631193`*^9}, {3.61782819385299*^9, 3.6178282011797667`*^9}, {
   3.6179591765022383`*^9, 3.617959209184119*^9}, {3.6179592878656197`*^9, 
   3.617959379436677*^9}, {3.617959421602426*^9, 3.617959482552107*^9}, {
   3.617959547454577*^9, 3.617959581060254*^9}, {3.617959628537272*^9, 
   3.617959642369183*^9}, {3.617959675506217*^9, 3.617959780499118*^9}, {
   3.6179598309410563`*^9, 3.617959834185457*^9}, {3.6179598742511044`*^9, 
   3.6179598922024927`*^9}, {3.6179599552815866`*^9, 3.617959995107527*^9}, {
   3.617960043419197*^9, 3.61796008279629*^9}, {3.617960280305327*^9, 
   3.617960297677414*^9}, {3.61796033326857*^9, 3.617960357114407*^9}, {
   3.6183129612832336`*^9, 3.618313034689784*^9}, {3.618313136838161*^9, 
   3.618313140939762*^9}, {3.618313179547*^9, 3.6183131811364393`*^9}, {
   3.6183132178497477`*^9, 3.6183132194130583`*^9}, {3.618313312004858*^9, 
   3.618313313213132*^9}, {3.6183134082863293`*^9, 3.618313410846789*^9}, {
   3.6183134736180277`*^9, 3.618313473915037*^9}, {3.618313702183085*^9, 
   3.618313702625905*^9}, {3.618314888223068*^9, 3.618314901470113*^9}, {
   3.618315084407844*^9, 3.61831512406703*^9}, {3.618315179803581*^9, 
   3.618315215227646*^9}, {3.618315249742679*^9, 3.618315274217766*^9}, {
   3.618315306762825*^9, 3.61831530755789*^9}, {3.6183153845665913`*^9, 
   3.618315404644771*^9}, {3.6183154667092667`*^9, 3.6183154669730997`*^9}, {
   3.6183155245597153`*^9, 3.6183155687732887`*^9}, {3.61831560061415*^9, 
   3.618315600957123*^9}, {3.6183156383817577`*^9, 3.618315638590605*^9}, 
   3.6183156693873177`*^9, {3.618315706451846*^9, 3.618315763983556*^9}, {
   3.618315797831501*^9, 3.61831593076504*^9}, {3.618438234670376*^9, 
   3.6184382405765457`*^9}, {3.618438336039559*^9, 3.618438351906622*^9}, {
   3.618438466494252*^9, 3.618438473829919*^9}, {3.61843853346423*^9, 
   3.618438559149268*^9}, 3.618438637006975*^9, {3.618438671110067*^9, 
   3.6184386763072767`*^9}, {3.618438710222258*^9, 3.6184387725838127`*^9}, {
   3.618438835108387*^9, 3.618438853036276*^9}, {3.61843888823919*^9, 
   3.618438913866881*^9}, {3.6186066109392767`*^9, 3.6186066164012423`*^9}, {
   3.618606707735825*^9, 3.61860673175471*^9}, {3.618606786416422*^9, 
   3.61860681003906*^9}, {3.618647174736285*^9, 3.618647537555564*^9}, {
   3.6186483584075527`*^9, 3.618648499802384*^9}, {3.618689364676195*^9, 
   3.618689455143523*^9}, {3.618689510183406*^9, 3.618689520008863*^9}, {
   3.618689680376751*^9, 3.6186896922869987`*^9}, {3.61868974013824*^9, 
   3.618689740399493*^9}, {3.618689795162006*^9, 3.618689795733613*^9}, {
   3.618689845446323*^9, 3.6186898911102667`*^9}, {3.618690002303701*^9, 
   3.618690090700935*^9}, {3.6186901240389633`*^9, 3.618690124301112*^9}, {
   3.6186902876065683`*^9, 3.618690363624654*^9}, {3.618690569684964*^9, 
   3.618690599432577*^9}, {3.618690683483267*^9, 3.6186906875103407`*^9}, {
   3.618690732743752*^9, 3.618690733348872*^9}, {3.618690781807254*^9, 
   3.618690782133515*^9}, {3.6186908586795893`*^9, 3.618690949663961*^9}, {
   3.6186909995988073`*^9, 3.618691011510819*^9}, {3.618691047125395*^9, 
   3.6186910990588007`*^9}, {3.618691149550366*^9, 3.618691258651575*^9}, {
   3.6186913088177643`*^9, 3.618691392934318*^9}, {3.618691459731372*^9, 
   3.618691461616254*^9}, {3.618691745726323*^9, 3.6186917464354897`*^9}, {
   3.618692018725031*^9, 3.618692032334763*^9}, {3.618692476235392*^9, 
   3.6186924769497623`*^9}, {3.618692621350019*^9, 3.6186926217918367`*^9}, {
   3.618692718486371*^9, 3.618692730621421*^9}, {3.618692782581242*^9, 
   3.6186927908924227`*^9}, {3.6186928282072763`*^9, 3.618692883282173*^9}, {
   3.618692922017374*^9, 3.618692922469288*^9}, {3.618692969025194*^9, 
   3.618693007660314*^9}, {3.618693111533263*^9, 3.618693121302891*^9}, {
   3.6186931525730543`*^9, 3.61869320138266*^9}, {3.618693239770238*^9, 
   3.6186933657628202`*^9}, {3.6186935045543747`*^9, 
   3.6186935623660994`*^9}, {3.618693640091762*^9, 3.61869372527061*^9}, {
   3.618693756798903*^9, 3.618693947779374*^9}, 3.6186939951460648`*^9, {
   3.618694071701563*^9, 3.618694075761047*^9}, {3.618694106254878*^9, 
   3.618694133351131*^9}, {3.6186941775403852`*^9, 3.618694251019438*^9}, {
   3.618694708604052*^9, 3.618694716930509*^9}, {3.618694823286509*^9, 
   3.6186948283654423`*^9}, {3.618695080653688*^9, 3.618695138007825*^9}, {
   3.618695388213625*^9, 3.618695391510824*^9}, {3.618695566190531*^9, 
   3.618695566566978*^9}, {3.618695668626095*^9, 3.61869566968852*^9}, {
   3.618695702177991*^9, 3.618695706235643*^9}, {3.6186957377432117`*^9, 
   3.618695788394806*^9}, 3.618695825214732*^9, {3.6186959137427683`*^9, 
   3.618695936277692*^9}, {3.6186962580337563`*^9, 3.618696272091798*^9}, {
   3.6186966228570423`*^9, 3.6186966623685713`*^9}, {3.6186966946397247`*^9, 
   3.618696703917056*^9}, {3.618696808712685*^9, 3.618696871801651*^9}, {
   3.618697102828294*^9, 3.6186971883798933`*^9}, {3.618697375798276*^9, 
   3.6186974140626507`*^9}, {3.618697640382986*^9, 3.618697643074438*^9}, {
   3.618698134068986*^9, 3.618698177955823*^9}, 3.6186982963335953`*^9, {
   3.618698986937443*^9, 3.6186989972155533`*^9}, {3.618788841349134*^9, 
   3.618788878729698*^9}, {3.618788934476849*^9, 3.6187890365117273`*^9}, {
   3.618789259111783*^9, 3.6187893550805883`*^9}, {3.618789418172419*^9, 
   3.618789487799371*^9}, {3.61879286336195*^9, 3.618792912705512*^9}, {
   3.618792952629139*^9, 3.61879302885308*^9}, {3.618793073565535*^9, 
   3.618793076000811*^9}, {3.618793131320917*^9, 3.618793131946537*^9}, {
   3.6187931637250853`*^9, 3.6187933817688*^9}, {3.618793415942422*^9, 
   3.61879345376294*^9}, 3.618793517845415*^9, {3.6187937383902483`*^9, 
   3.618793824025093*^9}, {3.618793888925666*^9, 3.618793941845289*^9}, {
   3.6187939868155737`*^9, 3.618793996630136*^9}, {3.618867141807448*^9, 
   3.6188672212138147`*^9}, {3.618867257257461*^9, 3.6188672698261223`*^9}, {
   3.618867301783328*^9, 3.618867318464278*^9}, {3.618867368639673*^9, 
   3.6188673780619926`*^9}, {3.619373065477799*^9, 3.619373106701137*^9}, {
   3.619385415920375*^9, 3.6193854321294117`*^9}, {3.63864064151845*^9, 
   3.6386406418697433`*^9}}],

Cell[BoxData[
 TagBox[
  StyleBox[
   DynamicModuleBox[{$CellContext`a$$ = 8, $CellContext`aStep$$ = 
    18, $CellContext`n$$ = 3, $CellContext`Nmag$$ = 2, $CellContext`r$$ = 
    0.005, Typeset`show$$ = True, Typeset`bookmarkList$$ = {}, 
    Typeset`bookmarkMode$$ = "Menu", Typeset`animator$$, Typeset`animvar$$ = 
    1, Typeset`name$$ = "\"untitled\"", Typeset`specs$$ = {{{
       Hold[$CellContext`r$$], 0.005, "ball radius (m)"}, 0.0005, 0.01}, {{
       Hold[$CellContext`a$$], 8, "air gap (ball radii)"}, 
      Dynamic[2 ($CellContext`n$$ - 1)], 20}, {{
       Hold[$CellContext`Nmag$$], 2, "stages"}, 1, 10, 1}, {{
       Hold[$CellContext`n$$], 3, "balls per stage"}, 2, 10, 1}, {{
       Hold[$CellContext`aStep$$], 0, "Animate"}, 0, 
      Dynamic[$CellContext`interSteps + ($CellContext`interSteps + \
$CellContext`n$$) $CellContext`Nmag$$], 1}}, Typeset`size$$ = {
    576., {189., 194.}}, Typeset`update$$ = 0, Typeset`initDone$$, 
    Typeset`skipInitDone$$ = True, $CellContext`r$28565$$ = 
    0, $CellContext`a$28566$$ = 0, $CellContext`Nmag$28567$$ = 
    0, $CellContext`n$28568$$ = 0, $CellContext`aStep$28569$$ = 0}, 
    DynamicBox[Manipulate`ManipulateBoxes[
     1, StandardForm, 
      "Variables" :> {$CellContext`a$$ = 8, $CellContext`aStep$$ = 
        0, $CellContext`n$$ = 3, $CellContext`Nmag$$ = 2, $CellContext`r$$ = 
        0.005}, "ControllerVariables" :> {
        Hold[$CellContext`r$$, $CellContext`r$28565$$, 0], 
        Hold[$CellContext`a$$, $CellContext`a$28566$$, 0], 
        Hold[$CellContext`Nmag$$, $CellContext`Nmag$28567$$, 0], 
        Hold[$CellContext`n$$, $CellContext`n$28568$$, 0], 
        Hold[$CellContext`aStep$$, $CellContext`aStep$28569$$, 0]}, 
      "OtherVariables" :> {
       Typeset`show$$, Typeset`bookmarkList$$, Typeset`bookmarkMode$$, 
        Typeset`animator$$, Typeset`animvar$$, Typeset`name$$, 
        Typeset`specs$$, Typeset`size$$, Typeset`update$$, Typeset`initDone$$,
         Typeset`skipInitDone$$}, "Body" :> 
      Module[{$CellContext`ofset$, $CellContext`magposes$, \
$CellContext`ballposes$, $CellContext`collpos$, $CellContext`stage$, \
$CellContext`velocity$, $CellContext`textPos$, $CellContext`interStepsFine$ = 
         50}, $CellContext`interSteps = 4; 
        If[$CellContext`a$$ < 2 ($CellContext`n$$ - 1), $CellContext`a$$ = 
          2 ($CellContext`n$$ - 1)]; 
        If[$CellContext`aStep$$ > $CellContext`interSteps + \
($CellContext`interSteps + $CellContext`n$$) $CellContext`Nmag$$, \
$CellContext`aStep$$ = $CellContext`interSteps + ($CellContext`interSteps + \
$CellContext`n$$) $CellContext`Nmag$$]; ListPlot[{
           Table[{
             $CellContext`ballPos[$CellContext`r$$, $CellContext`a$$, \
$CellContext`Nmag$$, $CellContext`n$$, $CellContext`aStep2, \
$CellContext`interStepsFine$], 
             $CellContext`veloc[$CellContext`r$$, $CellContext`a$$, \
$CellContext`Nmag$$, $CellContext`n$$, $CellContext`aStep2, \
$CellContext`interStepsFine$]}, {$CellContext`aStep2, 
             0, $CellContext`interStepsFine$ + ($CellContext`interStepsFine$ + \
$CellContext`n$$) $CellContext`Nmag$$}], 
           Table[{
             $CellContext`ballPos[$CellContext`r$$, $CellContext`a$$, \
$CellContext`Nmag$$, $CellContext`n$$, $CellContext`aStep2, 1], 
             $CellContext`veloc[$CellContext`r$$, $CellContext`a$$, \
$CellContext`Nmag$$, $CellContext`n$$, $CellContext`aStep2, 
              1]}, {$CellContext`aStep2, 1, 
             1 + (1 + $CellContext`n$$) $CellContext`Nmag$$ - 1}]}, 
          Joined -> {True, False}, 
          PlotRange -> {{
            Automatic, $CellContext`Nmag$$ 
              2 ($CellContext`a$$/2 + 
               1 + $CellContext`n$$) $CellContext`r$$ - (
              1 + $CellContext`a$$) $CellContext`r$$ + 0.1}, Automatic}, 
          MeshStyle -> PointSize[Large], PlotStyle -> {Thick, {
             PointSize[Large], Blue}}, 
          AxesOrigin -> {(-$CellContext`a$$) $CellContext`r$$ - 
            2 $CellContext`r$$, 0}, Frame -> {True, True, False, False}, 
          FrameLabel -> {"Moving Ball position (m)", "Velocity (m/s)"}, 
          FrameStyle -> Directive[18], Prolog -> {Red, 
            Line[{{-1, 
               $CellContext`veloc[$CellContext`r$$, $CellContext`a$$, \
$CellContext`Nmag$$, $CellContext`n$$, $CellContext`aStep$$, \
$CellContext`interSteps]}, {
               $CellContext`ballPos[$CellContext`r$$, $CellContext`a$$, \
$CellContext`Nmag$$, $CellContext`n$$, $CellContext`aStep$$, \
$CellContext`interSteps], 
               $CellContext`veloc[$CellContext`r$$, $CellContext`a$$, \
$CellContext`Nmag$$, $CellContext`n$$, $CellContext`aStep$$, \
$CellContext`interSteps]}, {
               $CellContext`ballPos[$CellContext`r$$, $CellContext`a$$, \
$CellContext`Nmag$$, $CellContext`n$$, $CellContext`aStep$$, \
$CellContext`interSteps], 0}}]}, ImageSize -> Large]], 
      "Specifications" :> {{{$CellContext`r$$, 0.005, "ball radius (m)"}, 
         0.0005, 0.01, Appearance -> 
         "Labeled"}, {{$CellContext`a$$, 8, "air gap (ball radii)"}, 
         Dynamic[2 ($CellContext`n$$ - 1)], 20, Appearance -> 
         "Labeled"}, {{$CellContext`Nmag$$, 2, "stages"}, 1, 10, 1, 
         Appearance -> "Labeled"}, {{$CellContext`n$$, 3, "balls per stage"}, 
         2, 10, 1, Appearance -> 
         "Labeled"}, {{$CellContext`aStep$$, 0, "Animate"}, 0, 
         Dynamic[$CellContext`interSteps + ($CellContext`interSteps + \
$CellContext`n$$) $CellContext`Nmag$$], 1, AnimationDirection -> Forward, 
         Appearance -> "Open"}}, "Options" :> {AppearanceElements -> "Open"}, 
      "DefaultOptions" :> {}],
     ImageSizeCache->{621., {295., 301.}},
     SingleEvaluation->True],
    Deinitialization:>None,
    DynamicModuleValues:>{},
    SynchronousInitialization->True,
    UndoTrackedVariables:>{Typeset`show$$, Typeset`bookmarkMode$$},
    UnsavedVariables:>{Typeset`initDone$$},
    UntrackedVariables:>{Typeset`size$$}], "Manipulate",
   Deployed->True,
   StripOnInput->False],
  Manipulate`InterpretManipulate[1]]], "Output",
 CellChangeTimes->{{3.618793815416203*^9, 3.6187938249346743`*^9}, {
   3.618793896861835*^9, 3.618793918409914*^9}, {3.618793961574849*^9, 
   3.618793997364802*^9}, {3.618867177049857*^9, 3.618867215247081*^9}, 
   3.618867265130781*^9, {3.6188673028910522`*^9, 3.618867325592449*^9}, {
   3.618867373044519*^9, 3.6188673788562937`*^9}, {3.6193725318199587`*^9, 
   3.6193725490897903`*^9}, {3.619373075802231*^9, 3.619373107857546*^9}, 
   3.619385054339094*^9, 3.619385381841511*^9, {3.619385418488574*^9, 
   3.619385432704343*^9}, {3.6386405632249823`*^9, 3.638640566914468*^9}, 
   3.6386406425650473`*^9}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1235, 684},
WindowMargins->{{3, Automatic}, {Automatic, 0}},
PrivateNotebookOptions->{"VersionedStylesheet"->{"Default.nb"[8.] -> False}},
FrontEndVersion->"10.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (September 9, \
2014)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[579, 22, 226, 3, 64, "Section"],
Cell[808, 27, 541, 12, 125, "Text"],
Cell[1352, 41, 12765, 342, 830, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[14142, 387, 35212, 762, 1485, "Input"],
Cell[49357, 1151, 19945, 420, 731, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[69339, 1576, 16757, 346, 514, "Input"],
Cell[86099, 1924, 6676, 117, 613, "Output"]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
